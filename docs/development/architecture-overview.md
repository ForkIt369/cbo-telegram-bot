# CBO-Bro Telegram Bot Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CBO-BRO TELEGRAM BOT SYSTEM                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   TELEGRAM USERS    â”‚         â”‚      DIGITALOCEAN APP PLATFORM      â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚                                     â”‚  â”‚
â”‚  â”‚  ğŸ‘¤ User sends      â”‚         â”‚  ğŸŒ https://cbo-demo-miniapp-        â”‚  â”‚
â”‚  â”‚     message to      â”‚ â”€â”€â”€â”€â”€â”€> â”‚     hs2sx.ondigitalocean.app       â”‚  â”‚
â”‚  â”‚     @cbo_DEVbot     â”‚         â”‚                                     â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  ğŸ“± Opens Mini App  â”‚ â”€â”€â”€â”€â”€â”€> â”‚  â”‚    EXPRESS SERVER:3003    â”‚   â”‚  â”‚
â”‚  â”‚     via menu        â”‚         â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”‚ TELEGRAM WEBHOOK  â”‚   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”‚ /telegram-webhook â”‚   â”‚   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚   TELEGRAM API      â”‚         â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ”” Webhook URL:    â”‚ <â”€â”€â”€â”€â”€â”€ â”‚  â”‚  â”‚   TELEGRAF BOT    â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  /telegram-webhook  â”‚         â”‚  â”‚  â”‚  - /start         â”‚   â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  â”‚  - /help          â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ¯ Bot Token:      â”‚         â”‚  â”‚  â”‚  - /status        â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  8139049417:AAE... â”‚         â”‚  â”‚  â”‚  - /clear         â”‚   â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  â”‚  - message handler â”‚   â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ“² Mini App:       â”‚         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚  â”‚  Configured in      â”‚         â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚  â”‚  BotFather          â”‚         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚  â”‚  MINI APP API     â”‚   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”‚  /api/chat/*      â”‚   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”‚  STATIC SERVING   â”‚   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â”‚  /mini-app/dist   â”‚   â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                  â”‚                                     â”‚  â”‚
â”‚                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚     CLAUDE SERVICE        â”‚   â”‚  â”‚
â”‚  â”‚   ANTHROPIC API     â”‚         â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  ğŸ¤– Model:                â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ”‘ API Key:        â”‚ <â”€â”€â”€â”€â”€â”€ â”‚  â”‚  claude-3-haiku-20240307  â”‚   â”‚  â”‚
â”‚  â”‚  (Encrypted in DO)  â”‚         â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  ğŸ“Š CBO-Bro Persona:      â”‚   â”‚  â”‚
â”‚  â”‚  ğŸ§  Processes:      â”‚         â”‚  â”‚  - Value Flow            â”‚   â”‚  â”‚
â”‚  â”‚  Business queries   â”‚         â”‚  â”‚  - Info Flow             â”‚   â”‚  â”‚
â”‚  â”‚  via BBMM framework â”‚         â”‚  â”‚  - Work Flow             â”‚   â”‚  â”‚
â”‚  â”‚                     â”‚         â”‚  â”‚  - Cash Flow             â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                  â”‚                                     â”‚  â”‚
â”‚                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚                                  â”‚  â”‚    MINI APP (REACT)       â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  ğŸ“± Built with:           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - React + Vite           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - Telegram UI Kit        â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - Tailwind CSS           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚                           â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  ğŸ¨ Features:             â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - Chat interface         â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - Quick actions          â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - CBO-Bro avatar        â”‚   â”‚  â”‚
â”‚                                  â”‚  â”‚  - Dark theme             â”‚   â”‚  â”‚
â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         ENVIRONMENT VARIABLES                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  NODE_ENV=production                                                â”‚  â”‚
â”‚  â”‚  PORT=3003                                                          â”‚  â”‚
â”‚  â”‚  TELEGRAM_BOT_TOKEN=***** (encrypted)                               â”‚  â”‚
â”‚  â”‚  ANTHROPIC_API_KEY=***** (encrypted)                                â”‚  â”‚
â”‚  â”‚  WEBHOOK_URL=https://cbo-mcp-system-hs2sx.ondigitalocean.app       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                            DATA FLOW                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  1. User sends message to @cbo_DEVbot                               â”‚  â”‚
â”‚  â”‚  2. Telegram API sends webhook POST to /telegram-webhook            â”‚  â”‚
â”‚  â”‚  3. Telegraf bot processes message                                  â”‚  â”‚
â”‚  â”‚  4. CBO Agent Handler manages conversation context                  â”‚  â”‚
â”‚  â”‚  5. Claude Service processes business query via API                 â”‚  â”‚
â”‚  â”‚  6. Response sent back to user via Telegram API                     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Mini App Flow:                                                     â”‚  â”‚
â”‚  â”‚  1. User opens Mini App from bot menu                              â”‚  â”‚
â”‚  â”‚  2. Mini App loads from /mini-app/dist                             â”‚  â”‚
â”‚  â”‚  3. Chat interface uses /api/chat/* endpoints                      â”‚  â”‚
â”‚  â”‚  4. Same backend processing as bot messages                        â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         DEPLOYMENT STATUS                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  ğŸŸ¢ Bot Service: HEALTHY                                            â”‚  â”‚
â”‚  â”‚  ğŸŸ¢ Health Check: OK (/health endpoint)                             â”‚  â”‚
â”‚  â”‚  ğŸŸ¢ Webhook: Configured                                             â”‚  â”‚
â”‚  â”‚  ğŸŸ¢ Mini App: Served at root path                                   â”‚  â”‚
â”‚  â”‚  ğŸŸ¡ Mini App URL: Needs BotFather configuration                     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  GitHub Repo: ForkIt369/cbo-telegram-bot                            â”‚  â”‚
â”‚  â”‚  Last Commit: Fix Claude service initialization                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Components

### 1. Telegram Bot (@cbo_DEVbot)
- **Username**: @cbo_DEVbot
- **Token**: 8139049417:AAEfmoNXmUhz4y842SdtKL8SjPwgYzIXDNI
- **Commands**: /start, /help, /status, /clear
- **Mini App**: Configured (needs URL in BotFather)

### 2. Backend Service
- **Framework**: Express.js + Telegraf
- **Port**: 3003
- **Endpoints**:
  - `/health` - Health check
  - `/telegram-webhook` - Telegram webhook
  - `/api/chat/*` - Mini App API
  - `/` - Mini App static files

### 3. Claude Integration
- **Service**: Direct Anthropic API (no MCP)
- **Model**: claude-3-haiku-20240307
- **Persona**: CBO-Bro with BBMM framework

### 4. Mini App
- **Framework**: React + Vite
- **UI**: Telegram UI Kit + Tailwind
- **Features**: Chat interface, quick actions, CBO avatar
- **Build**: Pre-built and committed to repo

### 5. Deployment
- **Platform**: DigitalOcean App Platform
- **URL**: https://cbo-mcp-system-hs2sx.ondigitalocean.app
- **Auto-deploy**: Enabled from master branch

## Next Steps

1. âœ… Bot is healthy and running
2. âœ… Mini App is built and served
3. â³ Configure Mini App URL in BotFather:
   - Use @BotFather
   - Select @cbo_DEVbot
   - Edit Bot > Bot Settings > Menu Button
   - Set URL: https://cbo-mcp-system-hs2sx.ondigitalocean.app/

## Security Notes

- API keys are encrypted in DigitalOcean environment variables
- Webhook uses HTTPS for secure communication
- No sensitive data stored in repository