name: cbo-mcp-system
region: nyc
services:
- name: cbo-mcp
  github:
    repo: ForkIt369/cbo-mcp-system
    branch: main
    deploy_on_push: true
  build_command: npm ci && npm run build
  run_command: node dist/cbo-mcp/index.js
  source_dir: /
  environment_slug: node-js
  instance_size_slug: apps-s-1vcpu-1gb
  instance_count: 1
  health_check:
    http_path: /health
  internal_ports:
  - 3000
  envs:
  - key: NODE_ENV
    value: production
    scope: RUN_AND_BUILD_TIME
  - key: PORT
    value: "3000"
    scope: RUN_AND_BUILD_TIME
  - key: SERVICE_NAME
    value: cbo-mcp
    scope: RUN_AND_BUILD_TIME

- name: memory-mcp
  github:
    repo: ForkIt369/cbo-mcp-system
    branch: main
    deploy_on_push: true
  build_command: npm ci && npm run build
  run_command: node dist/memory-mcp/index.js
  source_dir: /
  environment_slug: node-js
  instance_size_slug: apps-s-1vcpu-1gb
  instance_count: 1
  health_check:
    http_path: /health
  internal_ports:
  - 3001
  envs:
  - key: NODE_ENV
    value: production
    scope: RUN_AND_BUILD_TIME
  - key: PORT
    value: "3001"
    scope: RUN_AND_BUILD_TIME
  - key: SERVICE_NAME
    value: memory-mcp
    scope: RUN_AND_BUILD_TIME

- name: knowledge-mcp
  github:
    repo: ForkIt369/cbo-mcp-system
    branch: main
    deploy_on_push: true
  build_command: npm ci && npm run build
  run_command: node dist/knowledge-mcp/index.js
  source_dir: /
  environment_slug: node-js
  instance_size_slug: apps-s-1vcpu-1gb
  instance_count: 1
  health_check:
    http_path: /health
  internal_ports:
  - 3002
  envs:
  - key: NODE_ENV
    value: production
    scope: RUN_AND_BUILD_TIME
  - key: PORT
    value: "3002"
    scope: RUN_AND_BUILD_TIME
  - key: SERVICE_NAME
    value: knowledge-mcp
    scope: RUN_AND_BUILD_TIME

workers:
- name: telegram-bot
  github:
    repo: ForkIt369/cbo-telegram-bot
    branch: master
    deploy_on_push: true
  build_command: npm install
  run_command: node src/index.js
  source_dir: /
  environment_slug: node-js
  instance_size_slug: apps-s-1vcpu-1gb
  instance_count: 1
  envs:
  - key: NODE_ENV
    value: production
    scope: RUN_AND_BUILD_TIME
  - key: SERVICE_NAME
    value: telegram-bot
    scope: RUN_AND_BUILD_TIME
  - key: CBO_MCP_URL
    value: http://cbo-mcp:3000
    scope: RUN_AND_BUILD_TIME
  - key: MEMORY_MCP_URL
    value: http://memory-mcp:3001
    scope: RUN_AND_BUILD_TIME
  - key: KNOWLEDGE_MCP_URL
    value: http://knowledge-mcp:3002
    scope: RUN_AND_BUILD_TIME

alerts:
- rule: DEPLOYMENT_FAILED
- rule: DOMAIN_FAILED

features:
- buildpack-stack=ubuntu-22